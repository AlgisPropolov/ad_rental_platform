{% extends "base.html" %}
{% block title %}–°–¥–µ–ª–∫–∏{% endblock %}
{% block content %}

<h1>üíº –°–¥–µ–ª–∫–∏</h1>

<form method="get" style="margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <input type="text" name="q" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –æ–±—ä–µ–∫—Ç—É..." value="{{ query }}" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
    
    <select name="status" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="draft" {% if status == 'draft' %}selected{% endif %}>–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
        <option value="sent" {% if status == 'sent' %}selected{% endif %}>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ö–ü</option>
        <option value="signed" {% if status == 'signed' %}selected{% endif %}>–ü–æ–¥–ø–∏—Å–∞–Ω –¥–æ–≥–æ–≤–æ—Ä</option>
        <option value="closed" {% if status == 'closed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
    </select>

    <label>
        –°:
        <input type="date" name="start" value="{{ start }}" style="padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
    </label>
    <label>
        –ü–æ:
        <input type="date" name="end" value="{{ end }}" style="padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
    </label>

    <button type="submit" style="padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 6px;">üîé –§–∏–ª—å—Ç—Ä</button>
    <a href="{% url 'list_deals' %}" style="margin-left: 10px;">‚úñÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</a>
    <a href="{% url 'create_deal' %}" class="button" style="float: right;">‚ûï –ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞</a>
</form>

<table style="width: 100%; background: white; border-collapse: collapse; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <thead style="background: #f9f9f9;">
        <tr>
            <th style="padding: 10px; text-align: left;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th style="padding: 10px; text-align: left;">–ö–ª–∏–µ–Ω—Ç</th>
            <th style="padding: 10px; text-align: left;">–û–±—ä–µ–∫—Ç—ã</th>
            <th style="padding: 10px; text-align: left;">–°—Ç–∞—Ç—É—Å</th>
            <th style="padding: 10px; text-align: left;">–î–∞—Ç–∞</th>
            <th style="padding: 10px;"></th>
        </tr>
    </thead>
    <tbody>
        {% for deal in deals %}
            <tr style="{% if deal.status != 'closed' and deal.created_at.date < today %}background-color: #fff3f3;{% endif %}">
                <td style="padding: 10px;">{{ deal.title }}</td>
                <td style="padding: 10px;">{{ deal.client.name }}</td>
                <td style="padding: 10px;">
                    {% for asset in deal.assets.all %}
                        üèôÔ∏è {{ asset.name }}<br>
                    {% endfor %}
                </td>
                <td style="padding: 10px;">{{ deal.get_status_display }}</td>
                <td style="padding: 10px;">{{ deal.created_at|date:"d.m.Y" }}</td>
                <td style="padding: 10px;">
                    <a href="{% url 'edit_deal' deal.pk %}">‚úèÔ∏è</a>
                    <a href="{% url 'delete_deal' deal.pk %}">üóëÔ∏è</a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6" style="padding: 20px; text-align: center;">–ù–µ—Ç —Å–¥–µ–ª–æ–∫</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<br>
<a href="?export=csv" style="text-decoration: none; color: #007bff;">üìÅ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</a>

{% endblock %}
