<!-- ‚úÖ templates/core/analytics/index.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial; background: #f7f7f7; padding: 30px; }
        .chart-box { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .filters { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã</h1>

    <form method="get" class="filters">
        <label>–û—Ç: <input type="date" name="start" value="{{ start }}"></label>
        <label>–î–æ: <input type="date" name="end" value="{{ end }}"></label>
        <button type="submit">üîç –û–±–Ω–æ–≤–∏—Ç—å</button>
    </form>

    <div class="chart-box">
        <h2>üí∞ –î–æ—Ö–æ–¥ –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
        <div id="income_chart"></div>
    </div>

    <div class="chart-box">
        <h2>üìà –ö–æ–ª-–≤–æ –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫</h2>
        <div id="deals_chart"></div>
    </div>

    <div class="chart-box">
        <h2>üèôÔ∏è –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤</h2>
        <p><strong>{{ utilization }}%</strong> ‚Äî –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ –≤ —Ç–µ–∫—É—â–∏—Ö —Å–¥–µ–ª–∫–∞—Ö</p>
    </div>

    <script>
        const incomeData = {
            x: {{ income_labels|safe }},
            y: {{ income_values|safe }},
            type: 'bar',
            marker: { color: 'green' }
        };
        Plotly.newPlot('income_chart', [incomeData], { margin: { t: 30 } });

        const dealsData = {
            x: {{ deals_labels|safe }},
            y: {{ deals_values|safe }},
            type: 'bar',
            marker: { color: 'blue' }
        };
        Plotly.newPlot('deals_chart', [dealsData], { margin: { t: 30 } });
    </script>
</body>
</html>
